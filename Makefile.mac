NDKDIR=/Applications/Nuke6.0v7-32/Nuke6.0v7.app/Contents/MacOS

TARGET=SyLens.dylib
HEADERS=$(wildcard *.h)
SOURCES=$(wildcard *.cpp)
OBJECTS=$(SOURCES:.cpp=.o)

SDKROOT=/Developer/SDKs/MacOSX10.4u.sdk
LIBS ?= -lDDImage -lGLEW

CXXFLAGS+= -c -fPIC -DUSE_GLEW -I$(NDKDIR)/include  -msse -O3 -isysroot /Developer/SDKs/MacOSX10.4u.sdk -arch i386
LNFLAGS+=-bundle -undefined warning -flat_namespace -shared -rdynamic -nodefaultlibs -m32 -ggdb -lDDImage -lGLEW
LNFLAGS+=-L$(NDKDIR) -Wl,-syslibroot,/Developer/SDKs/MacOSX10.4u.sdk -arch i386

all: $(TARGET)

.cpp.o:
	$(CXX) $(CXXFLAGS) -c $<
	
$(TARGET): $(OBJECTS)
	$(CXX) -o $(TARGET) $(LNFLAGS) $(LIBS) $(OBJECTS)

clean:
	rm -f $(OBJECTS) $(TARGET)
	rm -rf dist
	
dist:
	mkdir dist
	cp README.txt dist/
	cp Manual.html dist/
	cp -r doc dist/
	cp sample.nk dist/
	cp -r SampleImg dist/
	cp *.so dist/
	cp *.dll dist/
	cp *.dylib dist/